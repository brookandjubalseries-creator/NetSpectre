<Window x:Class="NetSpectre.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:NetSpectre.ViewModels"
        xmlns:conv="clr-namespace:NetSpectre.Converters"
        xmlns:skia="clr-namespace:SkiaSharp.Views.WPF;assembly=SkiaSharp.Views.WPF"
        Title="NetSpectre — Network Traffic Analyzer"
        Height="850" Width="1400"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen"
        Style="{StaticResource DarkWindowStyle}"
        Closing="Window_Closing">

    <Window.InputBindings>
        <KeyBinding Key="F5" Command="{Binding StartCaptureCommand}" />
        <KeyBinding Key="F6" Command="{Binding StopCaptureCommand}" />
        <KeyBinding Key="K" Modifiers="Ctrl" Command="{Binding ClearPacketsCommand}" />
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding ApplyFilterCommand}" />
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SavePcapCommand}" />
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{Binding LoadPcapCommand}" />
        <KeyBinding Key="B" Modifiers="Ctrl" Command="{Binding ToggleBookmarkCommand}" />
    </Window.InputBindings>

    <Window.Resources>
        <conv:ProtocolToColorConverter x:Key="ProtocolToColorConverter" />
        <conv:ProtocolToRowColorConverter x:Key="ProtocolToRowColorConverter" />
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />    <!-- Toolbar -->
            <RowDefinition Height="Auto" />    <!-- Filter bar -->
            <RowDefinition Height="*" />       <!-- Packet list -->
            <RowDefinition Height="Auto" />    <!-- Splitter -->
            <RowDefinition Height="280" />     <!-- Bottom tabs -->
            <RowDefinition Height="Auto" />    <!-- Status bar -->
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0" Background="{StaticResource SurfaceBrush}" Padding="8,6">
            <DockPanel>
                <!-- Left: Logo + Controls -->
                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- App branding -->
                    <TextBlock Text="&#x25C8;" FontSize="22" Foreground="{StaticResource AccentBrush}"
                               VerticalAlignment="Center" Margin="0,0,6,0" />
                    <TextBlock Text="NetSpectre" FontSize="16" FontWeight="Bold"
                               Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center"
                               Margin="0,0,20,0" />

                    <!-- Interface selector -->
                    <TextBlock Text="Interface:" VerticalAlignment="Center" Margin="0,0,6,0"
                               Foreground="{StaticResource TextSecondaryBrush}" />
                    <ComboBox Width="220" ItemsSource="{Binding AvailableDevices}"
                              SelectedItem="{Binding SelectedDevice}"
                              DisplayMemberPath="FriendlyName"
                              IsEnabled="{Binding IsCapturing, Converter={StaticResource InvertBoolConverter}}"
                              VerticalAlignment="Center" Margin="0,0,8,0" />

                    <!-- Capture profiles -->
                    <ComboBox Width="120" ItemsSource="{Binding CaptureProfiles}"
                              SelectedItem="{Binding SelectedProfile}"
                              DisplayMemberPath="Name"
                              IsEnabled="{Binding IsCapturing, Converter={StaticResource InvertBoolConverter}}"
                              VerticalAlignment="Center" Margin="0,0,4,0">
                        <ComboBox.ToolTip>Capture Profiles</ComboBox.ToolTip>
                    </ComboBox>
                    <Button Command="{Binding SaveProfileCommand}" ToolTip="Save Current as Profile"
                            Padding="6,6" Margin="0,0,12,0">
                        <TextBlock Text="&#x1F4BE;" FontSize="12" />
                    </Button>

                    <!-- Capture controls -->
                    <Button Command="{Binding StartCaptureCommand}" ToolTip="Start Capture (F5)"
                            Margin="0,0,4,0" Padding="10,6"
                            IsEnabled="{Binding IsCapturing, Converter={StaticResource InvertBoolConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#x25B6;" Foreground="{StaticResource SuccessBrush}" Margin="0,0,6,0" />
                            <TextBlock Text="Start" />
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding StopCaptureCommand}" ToolTip="Stop Capture (F6)"
                            Margin="0,0,4,0" Padding="10,6"
                            IsEnabled="{Binding IsCapturing}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#x25A0;" Foreground="{StaticResource ErrorBrush}" Margin="0,0,6,0" />
                            <TextBlock Text="Stop" />
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding ClearPacketsCommand}" ToolTip="Clear (Ctrl+K)"
                            Margin="0,0,4,0" Padding="10,6">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#x2715;" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,6,0" />
                            <TextBlock Text="Clear" />
                        </StackPanel>
                    </Button>

                    <Border Width="1" Background="{StaticResource BorderBrush}" Margin="4,4,8,4" />

                    <!-- PCAP Save/Load -->
                    <Button Command="{Binding SavePcapCommand}" ToolTip="Save PCAP (Ctrl+S)"
                            Padding="8,6" Margin="0,0,4,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#x1F4BE;" FontSize="13" Margin="0,0,4,0" />
                            <TextBlock Text="Save" />
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding LoadPcapCommand}" ToolTip="Load PCAP (Ctrl+O)"
                            Padding="8,6" Margin="0,0,4,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#x1F4C2;" FontSize="13" Margin="0,0,4,0" />
                            <TextBlock Text="Load" />
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding OpenInWiresharkCommand}" ToolTip="Open in Wireshark"
                            Padding="8,6" Margin="0,0,4,0">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#x1F988;" FontSize="13" Margin="0,0,4,0" />
                            <TextBlock Text="Wireshark" />
                        </StackPanel>
                    </Button>

                    <Border Width="1" Background="{StaticResource BorderBrush}" Margin="4,4,8,4" />

                    <!-- Bookmark filter -->
                    <Button Command="{Binding FilterBookmarkedCommand}" ToolTip="Toggle Bookmarked Only"
                            Padding="8,6" Margin="0,0,4,0">
                        <TextBlock Text="&#x2606;" FontSize="14">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowBookmarkedOnly}" Value="True">
                                            <Setter Property="Foreground" Value="{StaticResource WarningBrush}" />
                                            <Setter Property="Text" Value="&#x2605;" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Button>

                    <Button Command="{Binding RefreshDevicesCommand}" ToolTip="Refresh Interfaces"
                            Padding="8,6" Margin="0,0,4,0">
                        <TextBlock Text="&#x21BB;" FontSize="14" />
                    </Button>

                    <Button Click="Settings_Click" ToolTip="Settings" Padding="8,6" Margin="0,0,4,0">
                        <TextBlock Text="&#x2699;" FontSize="14" />
                    </Button>

                    <Button Click="ToggleTheme_Click" ToolTip="Toggle Dark/Light Theme" Padding="8,6">
                        <TextBlock x:Name="ThemeIcon" Text="&#x2600;" FontSize="14" />
                    </Button>
                </StackPanel>

                <!-- Right: Capture indicator -->
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right"
                            VerticalAlignment="Center">
                    <Ellipse Width="10" Height="10" Margin="0,0,6,0"
                             VerticalAlignment="Center">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill" Value="{StaticResource TextDimBrush}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsCapturing}" Value="True">
                                        <Setter Property="Fill" Value="{StaticResource SuccessBrush}" />
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard x:Name="PulseStoryboard">
                                                <Storyboard RepeatBehavior="Forever">
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                     From="1.0" To="0.3" Duration="0:0:0.8"
                                                                     AutoReverse="True" />
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>
                                        <DataTrigger.ExitActions>
                                            <StopStoryboard BeginStoryboardName="PulseStoryboard" />
                                        </DataTrigger.ExitActions>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="Idle" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsCapturing}" Value="True">
                                        <Setter Property="Text" Value="Capturing" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Filter bar -->
        <Border Grid.Row="1" Background="{StaticResource BackgroundBrush}" Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="&#x1F50D;" VerticalAlignment="Center" Margin="0,0,8,0"
                           Foreground="{StaticResource TextDimBrush}" />
                <TextBox Grid.Column="1"
                         Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"
                         FontFamily="Consolas" FontSize="13"
                         VerticalAlignment="Center">
                    <TextBox.Style>
                        <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding HasFilterError}" Value="True">
                                    <Setter Property="BorderBrush" Value="{StaticResource ErrorBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                    <TextBox.ToolTip>
                        <TextBlock Text="{Binding FilterErrorMessage}" />
                    </TextBox.ToolTip>
                </TextBox>
                <Button Grid.Column="2" Content="Apply" Margin="8,0,0,0"
                        Command="{Binding ApplyFilterCommand}" Padding="12,4" />
            </Grid>
        </Border>

        <!-- Packet List DataGrid -->
        <DataGrid Grid.Row="2" ItemsSource="{Binding Packets}"
                  SelectedItem="{Binding SelectedPacket}"
                  FontFamily="Consolas" FontSize="12"
                  RowHeight="24">
            <DataGrid.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Copy Source Address" Command="{Binding CopySourceAddressCommand}" />
                    <MenuItem Header="Copy Destination Address" Command="{Binding CopyDestAddressCommand}" />
                    <Separator />
                    <MenuItem Header="Apply as Filter (Source)" Command="{Binding FilterBySourceCommand}" />
                    <MenuItem Header="Apply as Filter (Destination)" Command="{Binding FilterByDestCommand}" />
                    <Separator />
                    <MenuItem Header="Toggle Bookmark (Ctrl+B)" Command="{Binding ToggleBookmarkCommand}" />
                    <MenuItem Header="Follow TCP Stream" Command="{Binding FollowStreamCommand}" />
                    <Separator />
                    <MenuItem Header="Send to Crafter" Command="{Binding SendToCrafterCommand}" />
                </ContextMenu>
            </DataGrid.ContextMenu>
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
                    <Setter Property="Background"
                            Value="{Binding Protocol, Converter={StaticResource ProtocolToRowColorConverter}}" />
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsBookmarked}" Value="True">
                            <Setter Property="BorderBrush" Value="{StaticResource WarningBrush}" />
                            <Setter Property="BorderThickness" Value="2,0,0,0" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
            <DataGrid.Columns>
                <DataGridTemplateColumn Header="&#x2606;" Width="30">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock HorizontalAlignment="Center" FontSize="12">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsBookmarked}" Value="True">
                                                <Setter Property="Text" Value="&#x2605;" />
                                                <Setter Property="Foreground" Value="{StaticResource WarningBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="No." Width="70"
                                    Binding="{Binding Number}" />
                <DataGridTextColumn Header="Time" Width="110"
                                    Binding="{Binding Timestamp, StringFormat=HH:mm:ss.fff}" />
                <DataGridTextColumn Header="Source" Width="180"
                                    Binding="{Binding SourceAddress}" />
                <DataGridTextColumn Header="Destination" Width="180"
                                    Binding="{Binding DestinationAddress}" />
                <DataGridTemplateColumn Header="Protocol" Width="90">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Protocol}"
                                       Foreground="{Binding Protocol, Converter={StaticResource ProtocolToColorConverter}}"
                                       FontWeight="SemiBold" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Length" Width="80"
                                    Binding="{Binding Length}" />
                <DataGridTextColumn Header="Info" Width="*"
                                    Binding="{Binding Info}" />
            </DataGrid.Columns>
        </DataGrid>

        <!-- Splitter -->
        <GridSplitter Grid.Row="3" Height="4" ResizeDirection="Rows" />

        <!-- Bottom Tab Panel -->
        <TabControl Grid.Row="4" SelectedIndex="{Binding SelectedBottomTab}">
            <TabItem Header="Packet Details">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Protocol Tree -->
                    <TreeView Grid.Column="0" Margin="4"
                              ItemsSource="{Binding SelectedPacket.Layers.LayerStack}">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Fields}">
                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold"
                                           Foreground="{StaticResource AccentBrush}" />
                                <HierarchicalDataTemplate.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Name}"
                                                       Foreground="{StaticResource TextSecondaryBrush}" />
                                            <TextBlock Text=": " Foreground="{StaticResource TextDimBrush}" />
                                            <TextBlock Text="{Binding Value}"
                                                       Foreground="{StaticResource TextPrimaryBrush}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </HierarchicalDataTemplate.ItemTemplate>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>

                    <GridSplitter Grid.Column="1" Width="4" ResizeDirection="Columns" />

                    <!-- Hex View placeholder -->
                    <Border Grid.Column="2" Background="{StaticResource SurfaceBrush}" Margin="4"
                            CornerRadius="4">
                        <TextBlock Text="Hex View — Select a packet" FontFamily="Consolas"
                                   Foreground="{StaticResource TextDimBrush}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                </Grid>
            </TabItem>

            <TabItem Header="Network Graph">
                <Grid Margin="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,4">
                        <TextBlock Text="Live network topology — nodes sized by traffic, colored edges by protocol"
                                   Foreground="{StaticResource TextDimBrush}" VerticalAlignment="Center" />
                    </StackPanel>
                    <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" CornerRadius="4"
                            ClipToBounds="True">
                        <skia:SKElement x:Name="GraphCanvas" PaintSurface="GraphCanvas_PaintSurface"
                                        MouseDown="GraphCanvas_MouseDown"
                                        MouseMove="GraphCanvas_MouseMove"
                                        MouseUp="GraphCanvas_MouseUp"
                                        MouseWheel="GraphCanvas_MouseWheel" />
                    </Border>
                </Grid>
            </TabItem>

            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Alerts" />
                        <TextBlock Text="{Binding AlertsVm.AlertCount, FallbackValue=0}"
                                   Foreground="{StaticResource WarningBrush}" Margin="6,0,0,0"
                                   FontSize="11" VerticalAlignment="Center" />
                    </StackPanel>
                </TabItem.Header>
                <Grid DataContext="{Binding AlertsVm}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="4,4,4,0">
                        <Button Content="Clear Alerts" Command="{Binding ClearAlertsCommand}"
                                Padding="10,4" Margin="0,0,8,0" />
                        <Button Content="Export CSV" Command="{Binding ExportCsvCommand}"
                                Padding="10,4" />
                        <TextBlock Margin="16,0,0,0" VerticalAlignment="Center"
                                   Foreground="{StaticResource TextDimBrush}">
                            <Run Text="Critical: " />
                            <Run Text="{Binding CriticalCount, Mode=OneWay}" Foreground="{StaticResource ErrorBrush}" />
                            <Run Text="  Warning: " />
                            <Run Text="{Binding WarningCount, Mode=OneWay}" Foreground="{StaticResource WarningBrush}" />
                        </TextBlock>
                    </StackPanel>
                    <DataGrid Grid.Row="1" ItemsSource="{Binding Alerts}"
                              SelectedItem="{Binding SelectedAlert}"
                              FontFamily="Consolas" FontSize="12"
                              RowHeight="24">
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
                                <Setter Property="Background"
                                        Value="{Binding Severity, Converter={StaticResource AlertSeverityToColorConverter}}" />
                            </Style>
                        </DataGrid.RowStyle>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Width="50" Binding="{Binding Id}" />
                            <DataGridTextColumn Header="Time" Width="110"
                                                Binding="{Binding Timestamp, StringFormat=HH:mm:ss.fff}" />
                            <DataGridTemplateColumn Header="Severity" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Severity}"
                                                   Foreground="{Binding Severity, Converter={StaticResource AlertSeverityTextConverter}}"
                                                   FontWeight="Bold" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Detector" Width="160" Binding="{Binding DetectorName}" />
                            <DataGridTextColumn Header="Title" Width="200" Binding="{Binding Title}" />
                            <DataGridTextColumn Header="Source" Width="140" Binding="{Binding SourceAddress}" />
                            <DataGridTextColumn Header="Description" Width="*" Binding="{Binding Description}" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Statistics Tab -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Statistics" />
                        <TextBlock Text="{Binding StreamCount, FallbackValue=0}"
                                   Foreground="{StaticResource AccentBrush}" Margin="6,0,0,0"
                                   FontSize="11" VerticalAlignment="Center" />
                    </StackPanel>
                </TabItem.Header>
                <Grid Margin="4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <!-- Protocol Distribution (Pie) -->
                    <Border Grid.Column="0" Background="{StaticResource SurfaceBrush}" CornerRadius="4"
                            ClipToBounds="True" Margin="0,0,2,0">
                        <skia:SKElement x:Name="StatsPieCanvas" PaintSurface="StatsPieCanvas_PaintSurface" />
                    </Border>
                    <!-- Top Talkers (Bar) -->
                    <Border Grid.Column="1" Background="{StaticResource SurfaceBrush}" CornerRadius="4"
                            ClipToBounds="True" Margin="2,0,2,0">
                        <skia:SKElement x:Name="StatsBarCanvas" PaintSurface="StatsBarCanvas_PaintSurface" />
                    </Border>
                    <!-- Bandwidth Over Time (Line) -->
                    <Border Grid.Column="2" Background="{StaticResource SurfaceBrush}" CornerRadius="4"
                            ClipToBounds="True" Margin="2,0,0,0">
                        <skia:SKElement x:Name="StatsBandwidthCanvas" PaintSurface="StatsBandwidthCanvas_PaintSurface" />
                    </Border>
                </Grid>
            </TabItem>

            <TabItem Header="Packet Crafter">
                <Grid Margin="4" DataContext="{Binding CrafterVm}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="180" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Template List -->
                    <Border Grid.Column="0" Background="{StaticResource SurfaceBrush}" CornerRadius="4" Padding="8" Margin="0,0,4,0">
                        <StackPanel>
                            <TextBlock Text="Templates" FontWeight="SemiBold" Foreground="{StaticResource AccentBrush}"
                                       Margin="0,0,0,8" />
                            <ListBox ItemsSource="{Binding TemplateNames}" SelectedItem="{Binding SelectedTemplate}"
                                     Background="Transparent" BorderThickness="0" Foreground="{StaticResource TextPrimaryBrush}" />
                        </StackPanel>
                    </Border>

                    <!-- Packet Fields -->
                    <Border Grid.Column="1" Background="{StaticResource SurfaceBrush}" CornerRadius="4" Padding="12" Margin="0,0,4,0">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType">
                                <TextBlock Text="Ethernet" FontWeight="SemiBold" Foreground="{StaticResource AccentBrush}" Margin="0,0,0,6" />
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="32" />
                                        <RowDefinition Height="32" />
                                    </Grid.RowDefinitions>
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Src MAC:" VerticalAlignment="Center" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SrcMac}" FontFamily="Consolas" FontSize="14" />
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Dst MAC:" VerticalAlignment="Center" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding DstMac}" FontFamily="Consolas" FontSize="14" />
                                </Grid>

                                <TextBlock Text="IPv4" FontWeight="SemiBold" Foreground="{StaticResource AccentBrush}" Margin="0,0,0,6" />
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="32" />
                                        <RowDefinition Height="32" />
                                        <RowDefinition Height="32" />
                                    </Grid.RowDefinitions>
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Src IP:" VerticalAlignment="Center" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SrcIp}" FontFamily="Consolas" FontSize="14" />
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Dst IP:" VerticalAlignment="Center" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding DstIp}" FontFamily="Consolas" FontSize="14" />
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="TTL:" VerticalAlignment="Center" />
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding Ttl}" FontFamily="Consolas" FontSize="14" Width="60" HorizontalAlignment="Left" />
                                </Grid>

                                <TextBlock Text="Transport" FontWeight="SemiBold" Foreground="{StaticResource AccentBrush}" Margin="0,0,0,6" />
                                <Grid Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="32" />
                                        <RowDefinition Height="32" />
                                        <RowDefinition Height="32" />
                                    </Grid.RowDefinitions>
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Protocol:" VerticalAlignment="Center" />
                                    <ComboBox Grid.Row="0" Grid.Column="1" Width="80" HorizontalAlignment="Left"
                                              ItemsSource="{Binding Protocols}" SelectedItem="{Binding SelectedProtocol}" />
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Src Port:" VerticalAlignment="Center" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SrcPort}" FontFamily="Consolas" FontSize="14" Width="80" HorizontalAlignment="Left" />
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Dst Port:" VerticalAlignment="Center" />
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding DstPort}" FontFamily="Consolas" FontSize="14" Width="80" HorizontalAlignment="Left" />
                                </Grid>

                                <TextBlock Text="Payload" FontWeight="SemiBold" Foreground="{StaticResource AccentBrush}" Margin="0,0,0,6" />
                                <TextBox Text="{Binding PayloadText}" FontFamily="Consolas" FontSize="14" Height="50"
                                         AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" />
                            </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <!-- Actions -->
                    <Border Grid.Column="2" Background="{StaticResource SurfaceBrush}" CornerRadius="4" Padding="12" Width="140">
                        <StackPanel VerticalAlignment="Top">
                            <Button Content="Build" Command="{Binding BuildPacketCommand}" Margin="0,0,0,8" />
                            <Button Content="Send" Command="{Binding SendPacketCommand}" Margin="0,0,0,8" />
                            <TextBlock Text="{Binding StatusMessage}" TextWrapping="Wrap"
                                       Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" />
                        </StackPanel>
                    </Border>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <StatusBar Grid.Row="5">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}" />
            </StatusBarItem>
            <Separator Background="{StaticResource BorderBrush}" />
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Packets: " Foreground="{StaticResource TextDimBrush}" />
                    <TextBlock Text="{Binding PacketCount}" Foreground="{StaticResource AccentBrush}" />
                </StackPanel>
            </StatusBarItem>
            <Separator Background="{StaticResource BorderBrush}" />
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Displayed: " Foreground="{StaticResource TextDimBrush}" />
                    <TextBlock Text="{Binding DisplayedCount}" Foreground="{StaticResource AccentBrush}" />
                </StackPanel>
            </StatusBarItem>
            <Separator Background="{StaticResource BorderBrush}" />
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Streams: " Foreground="{StaticResource TextDimBrush}" />
                    <TextBlock Text="{Binding StreamCount}" Foreground="{StaticResource AccentBrush}" />
                </StackPanel>
            </StatusBarItem>
            <Separator Background="{StaticResource BorderBrush}" />
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="PPS: " Foreground="{StaticResource TextDimBrush}" />
                    <TextBlock Text="{Binding PacketsPerSecond}" Foreground="{StaticResource AccentBrush}" />
                </StackPanel>
            </StatusBarItem>
            <Separator Background="{StaticResource BorderBrush}" />
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Elapsed: " Foreground="{StaticResource TextDimBrush}" />
                    <TextBlock Text="{Binding CaptureElapsed}" />
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
